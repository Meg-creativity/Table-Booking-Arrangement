<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>黑色公鹿管理系統</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
        }
        /* 簡單的動畫效果 */
        .animate-in {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        /**
         * 注意：此代碼已根據 HotpotManagementApp.jsx 的架構完整移植
         * 包含：
         * 1. 5位共鍋邏輯
         * 2. 下一批可接客時間顯示
         * 3. 清潔中與預約保留狀態
         */
        const { useState, useEffect, useMemo } = React;
        
        // Lucide 圖標組件包裝器
        const Icon = ({ name, size = 16, className = "" }) => {
            const [ready, setReady] = useState(false);
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons();
                    setReady(true);
                }
            }, [name]);
            return <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;
        };

        const App = () => {
            const getLocalDateString = (date) => {
                const offset = date.getTimezoneOffset();
                const localDate = new Date(date.getTime() - (offset * 60 * 1000));
                return localDate.toISOString().split('T')[0];
            };

            const TABLES = [
                { id: '1', capacity: 4 },
                { id: '2', capacity: 4 },
                { id: '3', capacity: 4 },
                { id: '4', capacity: 4 },
                { id: '5', capacity: 4 },
                { id: '81', capacity: 2 },
                { id: '85', capacity: 2 },
            ];

            const SHIFTS = [
                { id: 'lunch', label: '午餐', start: '11:00', lastEntry: '13:30', end: '15:00' },
                { id: 'dinner', label: '晚餐', start: '17:00', lastEntry: '19:50', end: '21:30' }
            ];

            const DURATION = 90; 
            const BUFFER = 10;   
            const NOTIFY_BEFORE = 30; 
            const PREPARE_BEFORE = 60;

            const [activeTab, setActiveTab] = useState('tableStatus');
            const [bookings, setBookings] = useState([]);
            const [currentDate, setCurrentDate] = useState(getLocalDateString(new Date()));
            const [currentTime, setCurrentTime] = useState(new Date());
            const [quickSeatModal, setQuickSeatModal] = useState({ isOpen: false, tableId: null });
            const [editingBooking, setEditingBooking] = useState(null);
            const [formData, setFormData] = useState({
                name: '', phone: '', guests: 2, time: '11:00', tableId: '', date: currentDate
            });

            useEffect(() => {
                const timer = setInterval(() => setCurrentTime(new Date()), 10000);
                return () => clearInterval(timer);
            }, []);

            useEffect(() => {
                if (!editingBooking) {
                    setFormData(prev => ({ ...prev, date: currentDate }));
                }
            }, [currentDate, editingBooking]);

            const timeToMinutes = (timeStr) => {
                if (!timeStr) return 0;
                const [h, m] = timeStr.split(':').map(Number);
                return h * 60 + m;
            };

            const minutesToTime = (totalMinutes) => {
                const h = Math.floor(totalMinutes / 60);
                const m = totalMinutes % 60;
                return `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}`;
            };

            const getEndTime = (startTimeStr) => minutesToTime(timeToMinutes(startTimeStr) + DURATION);
            const getAvailableTime = (startTimeStr) => minutesToTime(timeToMinutes(startTimeStr) + DURATION + BUFFER);

            const getNextAvailableStatus = (availableTimeStr) => {
                const availMins = timeToMinutes(availableTimeStr);
                const lunchShift = SHIFTS[0];
                const dinnerShift = SHIFTS[1];

                if (availMins <= timeToMinutes(lunchShift.lastEntry)) {
                    return { isValid: true, text: `下一批可入座：${availableTimeStr}` };
                }
                if (availMins > timeToMinutes(lunchShift.lastEntry) && availMins < timeToMinutes(dinnerShift.start)) {
                    return { isValid: true, text: `晚餐首批可接：${dinnerShift.start}` };
                }
                if (availMins <= timeToMinutes(dinnerShift.lastEntry)) {
                    return { isValid: true, text: `下一批可入座：${availableTimeStr}` };
                }
                return { isValid: false, text: "此班次已結束接客" };
            };

            const isToday = useMemo(() => currentDate === getLocalDateString(new Date()), [currentDate]);

            const generateTimeOptions = () => {
                const options = [];
                SHIFTS.forEach(shift => {
                    let current = timeToMinutes(shift.start);
                    const last = timeToMinutes(shift.lastEntry);
                    while (current <= last) {
                        options.push(minutesToTime(current));
                        current += 10;
                    }
                });
                return options;
            };

            const isTableConflict = (tableId, date, startTime, excludeId = null) => {
                const startMins = timeToMinutes(startTime);
                const endMinsWithBuffer = startMins + DURATION + BUFFER;
                return bookings.some(b => {
                    if (b.id === excludeId || b.tableId !== tableId || b.date !== date) return false;
                    const bStart = timeToMinutes(b.time);
                    const bAvailable = timeToMinutes(b.availableTime);
                    return (startMins < bAvailable) && (endMinsWithBuffer > bStart);
                });
            };

            const handleQuickSeat = (guests) => {
                const nowStr = currentTime.getHours().toString().padStart(2, '0') + ":" + currentTime.getMinutes().toString().padStart(2, '0');
                const newEntry = {
                    id: Date.now().toString(),
                    name: `現場客(${quickSeatModal.tableId})`,
                    phone: '-',
                    guests: guests,
                    time: nowStr,
                    endTime: getEndTime(nowStr),
                    availableTime: getAvailableTime(nowStr), 
                    tableId: quickSeatModal.tableId,
                    date: currentDate,
                    isWalkIn: true,
                    isFinished: false 
                };
                setBookings(prev => [...prev, newEntry]);
                setQuickSeatModal({ isOpen: false, tableId: null });
            };

            const handleCheckout = (bookingId) => {
                const nowStr = currentTime.getHours().toString().padStart(2, '0') + ":" + currentTime.getMinutes().toString().padStart(2, '0');
                const nowMins = timeToMinutes(nowStr);
                setBookings(prev => prev.map(b => b.id === bookingId ? { ...b, endTime: nowStr, availableTime: minutesToTime(nowMins + BUFFER), isFinished: true } : b));
            };

            const handleFinishCleaning = (bookingId) => {
                const nowStr = currentTime.getHours().toString().padStart(2, '0') + ":" + currentTime.getMinutes().toString().padStart(2, '0');
                setBookings(prev => prev.map(b => b.id === bookingId ? { ...b, availableTime: nowStr } : b));
            };

            const handleSaveBooking = () => {
                if (!formData.name || !formData.tableId) return alert("請填寫姓名並選擇桌號");
                const newBooking = { 
                    ...formData, 
                    id: editingBooking ? editingBooking.id : Date.now().toString(), 
                    endTime: getEndTime(formData.time), 
                    availableTime: getAvailableTime(formData.time), 
                    isFinished: false 
                };
                setBookings(editingBooking ? bookings.map(b => b.id === editingBooking.id ? newBooking : b) : [...bookings, newBooking]);
                setEditingBooking(null);
                setFormData({ name: '', phone: '', guests: 2, time: '11:00', tableId: '', date: currentDate });
                setActiveTab('bookingList');
            };

            const handleEditBooking = (booking) => {
                setEditingBooking(booking);
                setFormData(booking);
                setActiveTab('newBooking');
            };

            const TableStatusView = () => {
                const nowStr = currentTime.getHours().toString().padStart(2, '0') + ":" + currentTime.getMinutes().toString().padStart(2, '0');
                const nowMins = timeToMinutes(nowStr);

                return (
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        {TABLES.map(table => {
                            const currentOccupy = isToday ? bookings.find(b => 
                                b.tableId === table.id && b.date === currentDate && !b.isFinished && 
                                nowMins >= timeToMinutes(b.time) && nowMins < timeToMinutes(b.endTime)
                            ) : null;

                            const isCleaning = isToday ? bookings.find(b => 
                                b.tableId === table.id && b.date === currentDate && b.isFinished && nowMins < timeToMinutes(b.availableTime)
                            ) : null;

                            const todaysBookings = bookings
                                .filter(b => b.tableId === table.id && b.date === currentDate && !b.isFinished)
                                .sort((a, b) => timeToMinutes(a.time) - timeToMinutes(b.time));

                            const nextBooking = isToday 
                                ? todaysBookings.find(b => timeToMinutes(b.time) > (currentOccupy ? timeToMinutes(currentOccupy.time) : nowMins))
                                : todaysBookings[0];

                            let borderClass = "border-l-slate-200";
                            let statusText = "空位";
                            let statusColor = "text-slate-400";
                            let isUrgentNext = false;

                            if (currentOccupy) {
                                const timeLeft = timeToMinutes(currentOccupy.endTime) - nowMins;
                                if (timeLeft <= NOTIFY_BEFORE) {
                                    borderClass = "border-l-red-500 shadow-red-50";
                                    statusText = "即將結束";
                                    statusColor = "text-red-500 animate-pulse";
                                } else {
                                    borderClass = "border-l-blue-500 shadow-blue-50";
                                    statusText = "用餐中";
                                    statusColor = "text-blue-600";
                                }
                            } else if (isCleaning) {
                                borderClass = "border-l-orange-400 shadow-orange-50 bg-orange-50/20";
                                statusText = "清潔中";
                                statusColor = "text-orange-500";
                            } else if (nextBooking) {
                                const minsToNext = isToday ? (timeToMinutes(nextBooking.time) - nowMins) : 999;
                                if (isToday && minsToNext <= PREPARE_BEFORE) {
                                    borderClass = "border-l-purple-500 shadow-purple-100 bg-purple-50/30";
                                    statusText = "預約保留";
                                    statusColor = "text-purple-600 font-black";
                                    isUrgentNext = true;
                                } else if (!isToday) {
                                    borderClass = "border-l-slate-300";
                                    statusText = "已有預約";
                                    statusColor = "text-slate-500 font-bold";
                                }
                            }

                            return (
                                <div key={table.id} className={`bg-white border border-slate-100 border-l-4 rounded-xl p-5 shadow-sm transition-all ${borderClass}`}>
                                    <div className="flex justify-between items-start mb-4">
                                        <div>
                                            <h3 className="text-3xl font-black text-slate-800">{table.id}</h3>
                                            <p className={`text-sm font-bold mt-1 ${statusColor}`}>{statusText}</p>
                                        </div>
                                        <div className="text-right">
                                            <span className="text-xs bg-slate-50 text-slate-500 px-2 py-1 rounded-full font-bold">{table.capacity} 人</span>
                                            {currentOccupy && currentOccupy.guests === 5 && (
                                                <div className="mt-1 flex items-center justify-end gap-0.5 text-[10px] text-red-500 font-black">
                                                    <Icon name="alert-circle" size={10} /> 共鍋
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                    
                                    <div className="min-h-[90px] flex flex-col justify-center">
                                        {currentOccupy ? (
                                            <>
                                                <p className="text-sm font-bold text-slate-700 truncate">{currentOccupy.name}</p>
                                                <p className="text-[11px] text-slate-500 mb-2 font-medium italic">離場時間：{currentOccupy.endTime}</p>
                                                <button onClick={() => handleCheckout(currentOccupy.id)} className="w-full py-2 bg-green-50 text-green-600 border border-green-100 rounded-xl font-bold hover:bg-green-600 hover:text-white transition-all text-xs flex items-center justify-center gap-1">
                                                    <Icon name="credit-card" size={14} /> 結帳
                                                </button>
                                            </>
                                        ) : isCleaning ? (
                                            <div className="text-center flex flex-col gap-2">
                                                <div>
                                                    <p className="text-xs text-orange-400 font-bold">清潔至 {isCleaning.availableTime}</p>
                                                    <div className="w-full bg-orange-100 h-1 mt-1 rounded-full overflow-hidden">
                                                        <div className="bg-orange-400 h-full animate-pulse" style={{width: '60%'}}></div>
                                                    </div>
                                                </div>
                                                <button onClick={() => handleFinishCleaning(isCleaning.id)} className="w-full py-2 bg-orange-500 text-white rounded-xl font-bold hover:bg-orange-600 transition-all text-xs flex items-center justify-center gap-1 shadow-sm">
                                                    <Icon name="sparkles" size={14} /> 清潔完成
                                                </button>
                                            </div>
                                        ) : nextBooking && isUrgentNext ? (
                                            <div className="flex flex-col gap-2">
                                                <div className="bg-white border border-purple-200 p-2 rounded-lg">
                                                    <p className="text-[11px] text-purple-700 font-black flex items-center gap-1"><Icon name="clock" size={10}/> 預計抵達：{nextBooking.time}</p>
                                                    <p className="text-xs font-bold text-purple-900 truncate">{nextBooking.name} ({nextBooking.guests}位)</p>
                                                </div>
                                                <button disabled className="w-full py-3 bg-slate-100 text-slate-400 rounded-xl border border-slate-200 font-bold text-xs flex items-center justify-center gap-1 cursor-not-allowed">
                                                    <Icon name="x" size={14} /> 預約保留中
                                                </button>
                                            </div>
                                        ) : (
                                            <button 
                                                disabled={!isToday}
                                                onClick={() => setQuickSeatModal({ isOpen: true, tableId: table.id })}
                                                className={`w-full py-3 rounded-xl border border-dashed font-bold flex items-center justify-center gap-2 ${isToday ? 'bg-slate-50 text-slate-400 border-slate-200 hover:bg-orange-50 hover:text-orange-600' : 'bg-slate-50 text-slate-200 border-slate-100 cursor-not-allowed'}`}
                                            >
                                                <Icon name="user-plus" size={18} /> {isToday ? '即刻帶位' : '預覽模式'}
                                            </button>
                                        )}
                                    </div>

                                    <div className="mt-4 pt-3 border-t border-slate-50">
                                        <div className="flex justify-between items-center text-[11px]">
                                           <span className="text-slate-400">下場預約</span>
                                           <span className="font-bold text-slate-600">
                                             {nextBooking ? `${nextBooking.time} (${nextBooking.name})` : '目前無預約'}
                                           </span>
                                        </div>
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-slate-50/50 text-slate-900 pb-24">
                    <header className="bg-white border-b sticky top-0 z-20 px-6 py-4 flex flex-wrap justify-between items-center gap-4 shadow-sm">
                        <div>
                            <h1 className="text-xl font-black text-slate-800 tracking-tight">黑色公鹿管理系統</h1>
                            <p className="text-xs text-slate-400 font-bold flex items-center gap-1 mt-0.5">
                                <Icon name="clock" size={12}/> {isToday ? `系統時間：${currentTime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'})}` : '日期檢視模式'}
                            </p>
                        </div>
                        <div className="flex items-center gap-1 bg-slate-100 p-1 rounded-full border border-slate-200 shadow-inner">
                            <button onClick={() => { const d = new Date(currentDate); d.setDate(d.getDate() - 1); setCurrentDate(getLocalDateString(d)); }} className="p-2 hover:bg-white rounded-full transition-all text-slate-500 shadow-sm"><Icon name="chevron-left" size={18}/></button>
                            <div className="flex items-center gap-2 px-3">
                                <Icon name="calendar" size={14} className="text-slate-400" />
                                <input type="date" className="bg-transparent text-sm font-bold outline-none cursor-pointer text-slate-700" value={currentDate} onChange={(e) => setCurrentDate(e.target.value)} />
                            </div>
                            <button onClick={() => { const d = new Date(currentDate); d.setDate(d.getDate() + 1); setCurrentDate(getLocalDateString(d)); }} className="p-2 hover:bg-white rounded-full transition-all text-slate-500 shadow-sm"><Icon name="chevron-right" size={18}/></button>
                        </div>
                    </header>

                    <main className="p-6 max-w-7xl mx-auto">
                        <div className="flex justify-between items-center mb-8 gap-4 overflow-x-auto pb-2">
                            <div className="flex gap-2">
                                <button onClick={() => setActiveTab('tableStatus')} className={`px-6 py-2.5 rounded-full font-bold transition-all text-sm flex items-center gap-2 whitespace-nowrap ${activeTab === 'tableStatus' ? 'bg-slate-800 text-white shadow-lg' : 'bg-white border text-slate-500 hover:bg-slate-50'}`}>
                                    <Icon name="users" size={16}/> 現場桌況
                                </button>
                                <button onClick={() => setActiveTab('bookingList')} className={`px-6 py-2.5 rounded-full font-bold transition-all text-sm flex items-center gap-2 whitespace-nowrap ${activeTab === 'bookingList' ? 'bg-slate-800 text-white shadow-lg' : 'bg-white border text-slate-500 hover:bg-slate-50'}`}>
                                    <Icon name="calendar-clock" size={16}/> 預約清單
                                </button>
                            </div>
                            <button onClick={() => { setFormData({ name: '', phone: '', guests: 2, time: '11:00', tableId: '', date: currentDate }); setEditingBooking(null); setActiveTab('newBooking'); }} className="px-6 py-2.5 rounded-full font-bold bg-orange-600 text-white shadow-md text-sm flex items-center gap-2 hover:bg-orange-700 transition-all whitespace-nowrap"><Icon name="plus-circle" size={18}/>新增預約</button>
                        </div>

                        {activeTab === 'tableStatus' && <TableStatusView />}
                        
                        {activeTab === 'bookingList' && (
                            <div className="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden animate-in">
                                <div className="overflow-x-auto">
                                    <table className="w-full text-left">
                                        <thead className="bg-slate-50 border-b">
                                            <tr>
                                                <th className="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider">用餐時間段</th>
                                                <th className="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider">桌號</th>
                                                <th className="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider">客人資訊</th>
                                                <th className="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider">人數</th>
                                                <th className="px-6 py-4 text-xs font-bold text-slate-400 uppercase tracking-wider">操作</th>
                                            </tr>
                                        </thead>
                                        <tbody className="divide-y divide-slate-100">
                                            {bookings.filter(b => b.date === currentDate).sort((a,b) => timeToMinutes(a.time) - timeToMinutes(b.time)).map(booking => {
                                                const nextStatus = getNextAvailableStatus(booking.availableTime);
                                                return (
                                                    <tr key={booking.id} className={`hover:bg-slate-50/50 transition-colors ${booking.isFinished ? 'opacity-50' : ''}`}>
                                                        <td className="px-6 py-4">
                                                            <div className="flex flex-col">
                                                                <span className="text-sm font-bold text-slate-800">{booking.time} - {booking.endTime}</span>
                                                                <span className={`text-[10px] font-bold px-1.5 py-0.5 rounded w-fit mt-1 ${nextStatus.isValid ? 'text-orange-600 bg-orange-50' : 'text-slate-400 bg-slate-100'}`}>
                                                                    {nextStatus.text}
                                                                </span>
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <span className="bg-slate-100 text-slate-700 px-3 py-1 rounded-lg font-bold text-xs">{booking.tableId} 號桌</span>
                                                        </td>
                                                        <td className="px-6 py-4">
                                                            <div className="flex items-center gap-2">
                                                                <p className="text-sm font-bold text-slate-800">{booking.name}</p>
                                                                {booking.guests === 5 && (
                                                                    <span className="text-[10px] px-1.5 py-0.5 bg-red-100 text-red-600 rounded font-black flex items-center gap-0.5">
                                                                        <Icon name="alert-circle" size={10} /> 共鍋
                                                                    </span>
                                                                )}
                                                            </div>
                                                            <p className="text-xs text-slate-400 flex items-center gap-1 font-medium"><Icon name="phone" size={10}/> {booking.phone || '無資料'}</p>
                                                        </td>
                                                        <td className="px-6 py-4 text-sm font-bold text-slate-700">{booking.guests} 位</td>
                                                        <td className="px-6 py-4">
                                                            <div className="flex gap-2">
                                                               {!booking.isFinished && (
                                                                   <button onClick={() => handleEditBooking(booking)} className="p-2 text-blue-400 hover:bg-blue-50 rounded-lg transition-colors"><Icon name="edit-3" size={16} /></button>
                                                               )}
                                                               <button onClick={() => setBookings(bookings.filter(b => b.id !== booking.id))} className="p-2 text-red-300 hover:text-red-500 hover:bg-red-50 rounded-lg transition-colors"><Icon name="trash-2" size={16} /></button>
                                                            </div>
                                                        </td>
                                                    </tr>
                                                );
                                            })}
                                            {bookings.filter(b => b.date === currentDate).length === 0 && (
                                                <tr>
                                                    <td colSpan="5" className="px-6 py-12 text-center text-slate-400 text-sm italic">本日目前尚無預約或用餐紀錄</td>
                                                </tr>
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'newBooking' && (
                            <div className="max-w-2xl mx-auto bg-white p-8 rounded-3xl shadow-xl border border-slate-100 animate-in">
                                <div className="flex justify-between items-center mb-8">
                                    <h2 className="text-2xl font-black text-slate-800">{editingBooking ? '修改預約紀錄' : '建立新預約'}</h2>
                                    <button onClick={() => setActiveTab('bookingList')} className="p-2 text-slate-400 hover:bg-slate-50 rounded-full transition-all"><Icon name="x" size={24}/></button>
                                </div>
                                
                                <div className="space-y-6">
                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div className="space-y-2">
                                            <label className="text-xs font-bold text-slate-400 uppercase ml-1">預約日期</label>
                                            <input type="date" className="w-full p-4 bg-slate-50 border-0 rounded-2xl font-bold focus:ring-2 focus:ring-orange-500 outline-none" value={formData.date} onChange={e => setFormData({...formData, date: e.target.value, tableId: ''})} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-xs font-bold text-slate-400 uppercase ml-1">時間</label>
                                            <select className="w-full p-4 bg-slate-50 border-0 rounded-2xl font-bold focus:ring-2 focus:ring-orange-500 outline-none" value={formData.time} onChange={e => setFormData({...formData, time: e.target.value, tableId: ''})}>
                                                {generateTimeOptions().map(t => <option key={t} value={t}>{t}</option>)}
                                            </select>
                                        </div>
                                    </div>

                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div className="space-y-2">
                                            <label className="text-xs font-bold text-slate-400 uppercase ml-1">客人姓名</label>
                                            <input type="text" placeholder="王小明" className="w-full p-4 bg-slate-50 border-0 rounded-2xl font-bold focus:ring-2 focus:ring-orange-500 outline-none" value={formData.name} onChange={e => setFormData({...formData, name: e.target.value})} />
                                        </div>
                                        <div className="space-y-2">
                                            <label className="text-xs font-bold text-slate-400 uppercase ml-1">聯絡電話</label>
                                            <input type="text" placeholder="0912-345-678" className="w-full p-4 bg-slate-50 border-0 rounded-2xl font-bold focus:ring-2 focus:ring-orange-500 outline-none" value={formData.phone} onChange={e => setFormData({...formData, phone: e.target.value})} />
                                        </div>
                                    </div>

                                    <div>
                                        <label className="block text-xs font-bold text-slate-400 mb-3 uppercase ml-1 flex items-center justify-between">
                                            用餐人數
                                            {formData.guests === 5 && <span className="text-orange-600 animate-pulse font-black text-[10px] bg-orange-50 px-2 py-0.5 rounded-full">需告知客戶有一位需共鍋</span>}
                                        </label>
                                        <div className="flex gap-2">
                                            {[1,2,3,4,5].map(num => (
                                                <button key={num} onClick={() => setFormData({...formData, guests: num, tableId: ''})} className={`flex-1 py-4 rounded-2xl font-black border-2 transition-all flex flex-col items-center justify-center ${formData.guests === num ? 'bg-slate-800 border-slate-800 text-white shadow-lg' : 'bg-white border-slate-100 text-slate-400 hover:border-slate-300'}`}>
                                                    {num}
                                                    {num === 5 && <span className="text-[9px] mt-0.5 font-bold">(共鍋)</span>}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div>
                                        <label className="text-xs font-bold text-slate-400 uppercase ml-1 mb-3 block">選擇桌位</label>
                                        <div className="grid grid-cols-4 gap-2">
                                            {TABLES.map(table => {
                                                const conflict = isTableConflict(table.id, formData.date, formData.time, editingBooking?.id);
                                                const isAllowedForFive = formData.guests === 5 && ['1','2','3','4','5'].includes(table.id);
                                                const overCap = !isAllowedForFive && formData.guests > table.capacity;
                                                
                                                return (
                                                    <button 
                                                        key={table.id} 
                                                        disabled={conflict || overCap} 
                                                        onClick={() => setFormData({...formData, tableId: table.id})} 
                                                        className={`py-4 rounded-2xl font-bold border-2 transition-all flex flex-col items-center
                                                            ${conflict || overCap ? 'bg-slate-50 border-slate-50 text-slate-200 cursor-not-allowed' : 
                                                            formData.tableId === table.id ? 'bg-orange-500 border-orange-500 text-white shadow-md' : 'bg-white border-slate-100 text-slate-600 hover:border-orange-200'}`}
                                                    >
                                                        {table.id}
                                                        <span className={`text-[9px] mt-0.5 font-bold ${formData.tableId === table.id ? 'text-white' : 'text-slate-400 opacity-60'}`}>
                                                            {conflict ? '衝突' : (overCap ? '位少' : (isAllowedForFive ? '需共鍋' : '可選'))}
                                                        </span>
                                                    </button>
                                                );
                                            })}
                                        </div>
                                    </div>

                                    <div className="pt-6 flex gap-3">
                                        <button onClick={() => setActiveTab('bookingList')} className="flex-1 py-5 font-bold text-slate-400 hover:text-slate-600">放棄修改</button>
                                        <button onClick={handleSaveBooking} className="flex-[2] py-5 bg-slate-800 text-white rounded-3xl font-bold shadow-xl hover:bg-slate-900 transition-all flex items-center justify-center gap-2">
                                            <Icon name="check-circle" size={20}/> {editingBooking ? '確認儲存修改' : '確認預約訂位'}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </main>

                    {quickSeatModal.isOpen && (
                        <div className="fixed inset-0 z-50 flex items-center justify-center bg-slate-900/60 backdrop-blur-sm p-4">
                            <div className="bg-white w-full max-w-sm rounded-3xl p-8 shadow-2xl animate-in">
                                <div className="flex justify-between items-center mb-8">
                                    <h3 className="text-xl font-black text-slate-800">{quickSeatModal.tableId} 號桌 - 現場客</h3>
                                    <button onClick={() => setQuickSeatModal({ isOpen: false, tableId: null })} className="p-1 text-slate-300 hover:text-slate-600 transition-colors"><Icon name="x" size={24}/></button>
                                </div>
                                <p className="text-xs font-bold text-slate-400 mb-4 ml-1 uppercase">點選用餐人數即刻帶位</p>
                                <div className="grid grid-cols-3 gap-3">
                                    {[1, 2, 3, 4, 5].map(num => {
                                        const table = TABLES.find(t => t.id === quickSeatModal.tableId);
                                        const isAllowedForFive = num === 5 && ['1','2','3','4','5'].includes(table.id);
                                        const disabled = !isAllowedForFive && num > table.capacity;
                                        return (
                                            <button 
                                                key={num} 
                                                disabled={disabled} 
                                                onClick={() => handleQuickSeat(num)} 
                                                className={`py-5 rounded-2xl font-black text-2xl border-2 transition-all flex flex-col items-center justify-center
                                                    ${disabled ? 'opacity-10 grayscale cursor-not-allowed' : 'border-slate-100 hover:border-orange-500 hover:bg-orange-50 text-slate-700'}`}
                                            >
                                                {num}
                                                {num === 5 && <span className="text-[10px] font-bold text-red-500">共鍋</span>}
                                            </button>
                                        );
                                    })}
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
